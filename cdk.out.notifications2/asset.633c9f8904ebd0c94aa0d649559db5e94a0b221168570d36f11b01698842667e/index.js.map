{
  "version": 3,
  "sources": ["../../backend/services/api/notifications/list-subscriptions.ts"],
  "sourcesContent": ["/**\n * GET /api/v1/notifications/subscriptions\n * \n * List all push subscriptions for the authenticated user\n * Returns active and inactive subscriptions\n */\n\nimport { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, QueryCommand } from '@aws-sdk/lib-dynamodb';\nimport type { ListSubscriptionsResponse, PushSubscription } from '../../types/notification.types';\n\nconst dynamoClient = new DynamoDBClient({});\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\n\nconst TABLE_NAME = process.env.TABLE_NAME!;\n\n/**\n * Lambda handler\n */\nexport async function handler(event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> {\n  console.log('List subscriptions:', JSON.stringify(event, null, 2));\n\n  try {\n    // Get user from JWT (added by authorizer)\n    const userId = event.requestContext.authorizer?.claims?.sub;\n    if (!userId) {\n      return {\n        statusCode: 401,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ success: false, message: 'Unauthorized' }),\n      };\n    }\n\n    // Query all subscriptions for this user (active and inactive)\n    const result = await docClient.send(new QueryCommand({\n      TableName: TABLE_NAME,\n      KeyConditionExpression: 'pk = :pk AND begins_with(sk, :sk)',\n      FilterExpression: 'isDeleted = :notDeleted',\n      ExpressionAttributeValues: {\n        ':pk': `USER#${userId}`,\n        ':sk': 'PUSH_SUB#',\n        ':notDeleted': false,\n      },\n    }));\n\n    const subscriptions = (result.Items || []) as PushSubscription[];\n\n    // Map to response format (don't expose sensitive data like keys)\n    const response: ListSubscriptionsResponse = {\n      success: true,\n      subscriptions: subscriptions.map(sub => ({\n        subscriptionId: sub.subscriptionId,\n        deviceType: sub.deviceType,\n        platform: sub.platform,\n        isActive: sub.isActive,\n        createdAt: sub.createdAt,\n        lastUsedAt: sub.lastUsedAt,\n      })),\n    };\n\n    return {\n      statusCode: 200,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(response),\n    };\n\n  } catch (error) {\n    console.error('Error listing subscriptions:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ \n        success: false, \n        message: 'Internal server error' \n      }),\n    };\n  }\n}\n\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAQA,IAAAI,EAA+B,oCAC/BC,EAAqD,iCAG/CC,EAAe,IAAI,iBAAe,CAAC,CAAC,EACpCC,EAAY,yBAAuB,KAAKD,CAAY,EAEpDE,EAAa,QAAQ,IAAI,WAK/B,eAAsBN,EAAQO,EAA6D,CACzF,QAAQ,IAAI,sBAAuB,KAAK,UAAUA,EAAO,KAAM,CAAC,CAAC,EAEjE,GAAI,CAEF,IAAMC,EAASD,EAAM,eAAe,YAAY,QAAQ,IACxD,GAAI,CAACC,EACH,MAAO,CACL,WAAY,IACZ,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,UAAU,CAAE,QAAS,GAAO,QAAS,cAAe,CAAC,CAClE,EAkBF,IAAMC,EAAsC,CAC1C,QAAS,GACT,gBAhBa,MAAMJ,EAAU,KAAK,IAAI,eAAa,CACnD,UAAWC,EACX,uBAAwB,oCACxB,iBAAkB,0BAClB,0BAA2B,CACzB,MAAO,QAAQE,CAAM,GACrB,MAAO,YACP,cAAe,EACjB,CACF,CAAC,CAAC,GAE4B,OAAS,CAAC,GAKT,IAAIE,IAAQ,CACvC,eAAgBA,EAAI,eACpB,WAAYA,EAAI,WAChB,SAAUA,EAAI,SACd,SAAUA,EAAI,SACd,UAAWA,EAAI,UACf,WAAYA,EAAI,UAClB,EAAE,CACJ,EAEA,MAAO,CACL,WAAY,IACZ,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,UAAUD,CAAQ,CAC/B,CAEF,OAASE,EAAO,CACd,eAAQ,MAAM,+BAAgCA,CAAK,EAC5C,CACL,WAAY,IACZ,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,UAAU,CACnB,QAAS,GACT,QAAS,uBACX,CAAC,CACH,CACF,CACF",
  "names": ["list_subscriptions_exports", "__export", "handler", "__toCommonJS", "import_client_dynamodb", "import_lib_dynamodb", "dynamoClient", "docClient", "TABLE_NAME", "event", "userId", "response", "sub", "error"]
}
